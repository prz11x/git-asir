Despliegue de SonarQube con Docker en Ubuntu

##  1.Comprobación de requisitos

`docker --version`

Verifica que Docker está instalado.

`docker ps`

Comprueba que el servicio Docker funciona correctamente.

`docker compose version`

Verifica que Docker Compose (plugin) está disponible.

---

## 2️.Crear carpeta del proyecto

`mkdir -p ~/proyectos/sonarqube-docker`

Crea la carpeta del proyecto.

`cd ~/proyectos/sonarqube-docker`

Entra en la carpeta de trabajo.

---

## 3️.Ajuste del kernel (requerido por Elasticsearch)

`sysctl vm.max_map_count`

Muestra el valor actual.

`sudo sysctl -w vm.max_map_count=262144`

Cambia el valor temporalmente.

`echo "vm.max_map_count=262144" | sudo tee /etc/sysctl.d/99-sonarqube.conf`

Guarda el valor de forma permanente.

`sudo sysctl --system`

Aplica la configuración permanente.

`sysctl vm.max_map_count`

Comprueba que quedó en `262144`.

---

## 4️.Crear docker-compose.yml

`nano docker-compose.yml`

Crea y edita el archivo de configuración.

Pegar dentro:

`services:   db:     image: postgres:15     container_name: sonar-db     environment:       POSTGRES_USER: sonar       POSTGRES_PASSWORD: sonar       POSTGRES_DB: sonarqube     volumes:       - sonar_db_data:/var/lib/postgresql/data     networks:       - sonar-net     restart: unless-stopped    sonarqube:     image: sonarqube:community     container_name: sonarqube     depends_on:       - db     ports:       - "9000:9000"     environment:       SONAR_JDBC_URL: jdbc:postgresql://db:5432/sonarqube       SONAR_JDBC_USERNAME: sonar       SONAR_JDBC_PASSWORD: sonar     volumes:       - sonar_data:/opt/sonarqube/data       - sonar_extensions:/opt/sonarqube/extensions       - sonar_logs:/opt/sonarqube/logs     networks:       - sonar-net     restart: unless-stopped  volumes:   sonar_db_data:   sonar_data:   sonar_extensions:   sonar_logs:  networks:   sonar-net:     driver: bridge`

Guardar y salir:

`CTRL + O Enter CTRL + X`

---

## 5️. Levantar los contenedores

`docker compose up -d`

Inicia SonarQube y PostgreSQL en segundo plano.

`docker ps`

Comprueba que los contenedores están en ejecución.

---

## 6️. Ver logs

`docker logs -f sonarqube`

Muestra logs en tiempo real hasta que el servicio esté listo.

Salir de logs:

`CTRL + C`

---

## 7️. Acceso web

Abrir navegador:

`http://localhost:9000`

Credenciales iniciales:

`Usuario: admin Contraseña: admin`

---

## 8️. Diagnóstico básico

`docker logs --tail 200 sonarqube`

Muestra los últimos 200 logs para detectar errores.

`docker ps`

# FASE 2 — Crear proyectos y prepararlos para análisis



## 1️ Crear estructura base

`mkdir -p ~/proyectos/grupo01/proyecto-php/src`

Crea carpeta del proyecto PHP.

`mkdir -p ~/proyectos/grupo01/proyecto-java/src`

Crea carpeta del proyecto Java.

`cd ~/proyectos/grupo01`

Entra en la carpeta del grupo.

---

#  2️ Proyecto PHP en contenedor

`cd ~/proyectos/grupo01/proyecto-php`

Entra en el proyecto PHP.

---

## Crear archivo PHP

`nano src/index.php`

Crea y edita el archivo PHP.

(Guardar con CTRL+O → Enter → CTRL+X)

---

## Crear docker-compose del proyecto PHP

`nano docker-compose.yml`

Crea configuración del contenedor PHP.

Guardar y salir.

---

## Levantar contenedor

`docker compose up -d`

Inicia Apache + PHP en segundo plano.

`docker ps`

Verifica que el contenedor está activo.

Abrir en navegador:

`http://localhost:8081`

---

## Crear configuración Sonar para PHP

`nano sonar-project.properties`

Crea archivo de configuración para el análisis.

(Guardar y salir)

---

#  3️ Proyecto Java simple

`cd ~/proyectos/grupo01/proyecto-java`

Entra en proyecto Java.

`nano src/Main.java`

Crea clase Java.

Guardar y salir.

---

## Crear configuración Sonar para Java

`nano sonar-project.properties`

Crea archivo de configuración del proyecto Java.

Guardar y salir.

---

#  FASE 3 — Primer análisis con Sonar Scanner


## 1️ Crear token en SonarQube

Acceder a:

`http://localhost:9000`

Crear token en:

`User → My Account → Security → Generate Token`

Copiar el token generado.

---

## 2️ Analizar proyecto PHP

`cd ~/proyectos/grupo01/proyecto-php`

Entrar en el proyecto.

`sudo docker run --rm --network host \   -e SONAR_HOST_URL="http://127.0.0.1:9000" \   -e SONAR_TOKEN="TU_TOKEN_AQUI" \   -v "$(pwd):/usr/src" \   -w /usr/src \   sonarsource/sonar-scanner-cli \   -Dsonar.ws.timeout=120 \   -Dsonar.scanner.ws.timeout=120`