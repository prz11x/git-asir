# Activación de `.htaccess`

### Modificación del VirtualHost

Archivo editado:

`/etc/apache2/sites-available/000-default.conf`

Configuración necesaria:

`<Directory /var/www/html>     Options Indexes FollowSymLinks     AllowOverride All     Require all granted </Directory>`

Reinicio del servicio:

`sudo systemctl restart apache2`

Creación del archivo `.htaccess` inicial:

`AddDefaultCharset UTF-8`

---

# 2️ Autenticación Básica

## Creación de zona protegida

Directorio creado:

`/var/www/html/admin`

Archivo `.htpasswd` generado con:

`sudo htpasswd -c /var/www/html/.htpasswd admin`

Configuración en `/admin/.htaccess`:

`AuthType Basic AuthName "Zona restringida" AuthUserFile /var/www/html/.htpasswd Require valid-user`

Resultado: acceso restringido mediante usuario y contraseña.

---

# 3️ Gestión de Errores Personalizados
    

Configuración en `.htaccess`:

`ErrorDocument 404 /404.html ErrorDocument 403 /403.html`

Permite mostrar páginas personalizadas ante errores.

---

# 4️ Cabeceras de Seguridad

Módulo activado:

`sudo a2enmod headers sudo systemctl restart apache2`

Configuración añadida:

`Header set X-Frame-Options "DENY" Header set X-Content-Type-Options "nosniff" Header set X-XSS-Protection "1; mode=block" Header set Referrer-Policy "no-referrer-when-downgrade" Header set Permissions-Policy "geolocation=()"`

Objetivo: reducir riesgos de clickjacking, XSS, filtraciones de información y abuso de APIs del navegador.

---

# 5️ Redirecciones HTTP

### Redirección permanente (301)

`Redirect 301 /viejo.html /nuevo.html`

### Redirección temporal (302)

`Redirect 302 /promo /promo-2026`

Diferencia principal:

- 301 → cambio definitivo.
    
- 302 → cambio temporal.
    

---

# 6️ Reescritura de URLs (mod_rewrite)

Activación del módulo:

`sudo a2enmod rewrite sudo systemctl restart apache2`

---

## Eliminación de extensión

`RewriteEngine On RewriteRule ^hola$ hola.html [L]`

Permite acceder a:

`/hola`

aunque el archivo real sea `hola.html`.

---

## Patrón MVC (Front Controller)

Configuración:

`RewriteEngine On  RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d RewriteRule ^(.+)$ index.php?route=$1 [L,QSA]`

Permite capturar todas las rutas dinámicas en `index.php`.

Ejemplo:

`/usuarios/editar/7`

---

# 7️ Control de Listado de Directorios

Configuración:

`Options -Indexes`

Evita que Apache muestre el contenido de carpetas sin archivo `index`.

---

# 8️ Forzar HTTPS

`RewriteEngine On RewriteCond %{HTTPS} !=on RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]`

Requiere certificado SSL configurado.

---

# 9️ Optimización: Caché y Compresión

## Activación de módulos

`sudo a2enmod expires sudo a2enmod deflate sudo systemctl restart apache2`

## Configuración

`<IfModule mod_expires.c>    ExpiresActive On    ExpiresByType image/jpeg "access plus 30 days"    ExpiresByType text/css "access plus 7 days"    ExpiresByType application/javascript "access plus 7 days" </IfModule>  SetOutputFilter DEFLATE`


    

---

 Control de Indexación y SEO

## robots.txt

Archivo en raíz:

`User-agent: * Disallow: /admin/ Disallow: /backup/`

## Cabecera HTTP para no indexar

`Header set X-Robots-Tag "noindex, nofollow"`

---

# 1️1️ Restricción y Protección de Recursos

### Bloqueo total de carpeta

`Require all denied`

### Bloqueo por tipo de archivo

`<FilesMatch "\.(sql|bak|zip|tar)$">    Require all denied </FilesMatch>`

### Restringir por IP

`Require ip 192.168.1.0/24`